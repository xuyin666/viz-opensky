<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">

    <!-- import leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" 
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/> 
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" 
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" 
    crossorigin=""></script>

    <!-- import jquery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <!-- import font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<body>
    <div id="map"></div>
    <script>

        // the view from Paris 
        var map = L.map('map').setView([48.8566, 2.3522], 5);
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            // the accessToken get from Mapbox
            accessToken: 'pk.eyJ1Ijoibmljb2xhc3UiLCJhIjoiY2t4Yno4enhzMHNxNjJvbzdpN2ZqcW1veiJ9.D3junYb4Fyksl9eztv4YEQ'
        }).addTo(map);


        // var myIcon = L.divIcon({
        //     className: 'leaflet-marker-icon leaflet-zoom-animated',
        //     html: '<i class="fa fa-plane my-div-icon" style="font-size: 20px; "></i>'
        // });
        // Paris
        // L.marker([48.8566, 2.3522], {icon: myIcon}).addTo(map);
        // Lyon
        // L.marker([45.7640, 4.8357], {icon: myIcon}).addTo(map);

        let currentAjax = null;

        function getAllAirplane() {
            currentAjax = $.ajax({
                url: 'https://opensky-network.org/api/states/all',
                dataType: 'json'
            })
            .done(function(response) {
                if (currentAjax) {
                    currentAjax = null;
                }

                if (!response.states) {
                    return;
                }
                // console.log(response.states);
                // response.states.forEach(airplane => {
                //     console.log("latitude " + airplane[6] + "longitude " + airplane[5]);
                // });

                // console.log("total data length ", response.states.length);
                
                // return all the airplanes with a longtitude and latitude
                let airplaneList = response.states.filter(airplane => {
                    if (airplane[5] && airplane[6]){
                        return airplane;
                    }
                })
                // console.log("useful data length ", airplaneList.length);

                airplaneList.forEach(airplane => {


                var myIcon = L.divIcon({
                    className: 'leaflet-marker-icon leaflet-zoom-animated',
                    html: '<i class="fa fa-plane my-div-icon" style="font-size: 20px; "></i>'
                });
                // Paris
                L.marker([48.8566, 2.3522], {icon: myIcon}).addTo(map);
                let myMarker ;

                    // var parallaxMarker = L.Marker.parallax(
                    // {
                    //     lat: aircraft[6],
                    //     lng: aircraft[5]
                    // }, {
                    //     parallaxZoffset: aircraft[13] / 10, // use the altitude for the parallax z-offset value
                    //     icon: L.divIcon({
                    //     className: 'leaflet-marker-icon leaflet-zoom-animated leaflet-interactive',
                    //     html: '<i class="fas fa-plane fa-2x" style="transform:rotate(calc(-45deg + ' + aircraft[10] + 'deg)) scale(' + Math.max(1, aircraft[13] / 10500) + ');" aria-hidden="true"></i>'
                    //     })
                    // }
                    // );
                });


            })
        }

        getAllAirplane();
    </script>
</body>
</html>